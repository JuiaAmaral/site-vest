{% extends 'base.html' %} 
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/produtos.css' %}">

<div class="container-fluid my-4 px-3">
    <div class="row">
        <aside class="col-md-3">
            <form method="GET" action="{% url 'vitrine_produtos' %}" id="formFiltros">
                <div class="sidebar-filtros p-4 shadow-sm rounded bg-white">
                    <h5 class="fw-bold mb-4">Filtrar por</h5>

                    <div class="mb-4">
                        <label class="fw-bold small mb-2">O QUE VOCÊ BUSCA?</label>
                        <div class="input-group">
                            <input type="text" name="q" class="form-control form-control-sm" 
                                   placeholder="Ex: Jeans..." value="{{ request.GET.q|default:'' }}">
                        </div>
                    </div>

                    <hr>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" name="novidade" id="checkNovidade" 
                               {% if novidade_ativa %}checked{% endif %} onchange="this.form.submit()">
                        <label class="form-check-label fw-bold text-danger" for="checkNovidade">
                            ✨ NOVIDADES
                        </label>
                    </div>

                    <hr>

                    <div class="mb-4">
                        <strong>Seções</strong>
                        <div class="mt-2">
                            {% for s in secoes %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="secao" value="{{ s.id }}" id="secao{{ s.id }}"
                                       {% if s.id|stringformat:"i" in secoes_ativas %}checked{% endif %} onchange="this.form.submit()">
                                <label class="form-check-label" for="secao{{ s.id }}">{{ s.nome }}</label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <hr>

                    <div class="mb-4">
                        <strong>Categorias</strong>
                        <div class="mt-2">
                            {% for cat in categorias %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="categoria" value="{{ cat.id }}" id="cat{{ cat.id }}"
                                       {% if cat.id|stringformat:"i" in cats_ativas %}checked{% endif %} onchange="this.form.submit()">
                                <label class="form-check-label" for="cat{{ cat.id }}">{{ cat.nome }}</label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <a href="{% url 'vitrine_produtos' %}" class="btn btn-dark btn-sm w-100 mt-3">Limpar Filtros</a>
                </div>
            </form> 
        </aside>

        <main class="col-md-9">
            <header class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="m-0">Vitrine <span class="text-muted small">({{ produtos.count }} itens)</span></h4>
            </header>
    <div class="row g-4">
    {% for produto in produtos %}
    <div class="col-6 col-lg-4">

        <a href="{% url 'produto_detalhe' produto_id=produto.id %}"
           class="text-decoration-none text-dark">

            <div class="card h-100 border-0 shadow-sm p-2 produto-card">

                {% with produto.imagem_principal as img %}
                    {% if img %}
                        <img src="{{ img.imagem.url }}"
                        class="card-img-top rounded"
                             alt="{{ produto.nome }}"
                             style="height: 250px; object-fit: cover;">
                    {% endif %}
                {% endwith %}  

                <div class="card-body text-center p-2">
                    <h6 class="mb-1 text-truncate">{{ produto.nome }}</h6>
                    <p class="text-danger fw-bold m-0">R$ {{ produto.preco }}</p>
                </div>

            </div>
        </a>

    </div>
    {% endfor %}
    </div>
        </main>
</div>
{% endblock %}