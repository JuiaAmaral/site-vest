{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Vest Lavichy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{% static 'css/index.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<div class="top-bar">
    Frete grÃ¡tis em compras acima de R$199 â€¢ Parcele em atÃ© 10x sem juros
</div>

<header>
    <div class="container d-flex justify-content-between align-items-center py-3">
        <button class="btn d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#menuMobile">
            â˜°
        </button>

        <a href="{% url 'index' %}" class="logo text-decoration-none" style="display: flex; justify-content: center"><img src="../media/icones_categorias/VestLavichy.png"></a>

        <form action="{% url 'buscar' %}" method="GET" class="header-search d-flex">
            <input type="text" name="q" class="form-control flex-grow-1" placeholder="O que vocÃª estÃ¡ procurando?" value="{{ termo|default:'' }}">
            <button type="submit" class="btn text-white ms-2" style="background-color: #b11226;">Buscar</button>
        </form>

        <div class="header-icons d-none d-md-flex gap-3">
            {% if user.is_authenticated %}
                <span>OlÃ¡, {{ user.username }}!</span>
                <a href="{% url 'logout' %}">Sair</a>
            {% else %}
                <a href="/login">Entrar / Cadastrar</a>
            {% endif %}
            <a href="{% url 'carrinho_detalhe' %}">Carrinho</a>
            <a href="{% url 'meus_pedidos' %}">Meus Pedidos</a>
        </div>
    </div>

    <div class="menu-categorias py-2 d-none d-md-block">
        <div class="container d-flex justify-content-center gap-4">
            <a href="{% url 'vitrine_produtos' %}?novidade=true">Novidades</a> 
            {% for s in secoes %}
                {% if s.nome|lower != "novidade" %}
                    <a href="{% url 'vitrine_produtos' %}?secao={{ s.nome }}">{{ s.nome }}</a>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</header>

<div class="offcanvas offcanvas-start" tabindex="-1" id="menuMobile">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title">Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>

<div class="offcanvas-body">

    <!-- USUÃRIO -->
    {% if user.is_authenticated %}
        <p class="fw-bold mb-2">OlÃ¡, {{ user.username }} ðŸ‘‹</p>
        <a href="{% url 'logout' %}" class="menu-item d-block mb-3 text-danger">Sair</a>
    {% else %}
        <a href="/login" class="menu-item d-block mb-3 fw-bold">Entrar / Cadastrar</a>
    {% endif %}

    <hr>

    <!-- CATEGORIAS -->
    <a href="{% url 'vitrine_produtos' %}?novidade=true"
       class="menu-item d-block mb-2 fw-bold"
       style="color: #b11226;">
        âœ¨ Novidades
    </a>

    {% for s in secoes %}
        <a href="{% url 'vitrine_produtos' %}?secao={{ s.nome }}"
           class="menu-item d-block mb-2">
            {{ s.nome }}
        </a>
    {% endfor %}

    <hr>

    <!-- AÃ‡Ã•ES -->
    <a href="{% url 'carrinho_detalhe' %}" class="menu-item d-block mb-2">
        ðŸ›’ Carrinho
    </a>

    <a href="{% url 'meus_pedidos' %}" class="menu-item d-block mb-2">
        ðŸ“¦ Meus Pedidos
    </a>

</div>
</div>

<main>
    {% if modo_busca %}
        <div class="container my-5">
            <h3 class="mb-4">{{ qtd_resultados }} resultados para "{{ termo }}"</h3>
            <div class="row g-4">
                {% for produto in produtos %}
                <div class="col-6 col-md-3">
                    <a href="{% url 'produto_detalhe' produto.id %}" class="text-decoration-none text-dark">
                        <div class="card h-100 border-0 shadow-sm">
                            {% if produto.imagens.first %}
                                <img src="{{ produto.imagens.first.imagem.url }}" class="card-img-top">
                            {% endif %}
                            <div class="card-body text-center">
                                <h6 class="text-truncate">{{ produto.nome }}</h6>
                                <p class="text-danger fw-bold">R$ {{ produto.preco }}</p>
                            </div>
                        </div>
                    </a>
                </div>
                {% empty %}
                <p>Nenhum produto encontrado.</p>
                {% endfor %}
            </div>
            <a href="{% url 'index' %}" class="btn btn-secondary mt-3">Voltar para Home</a>
        </div>

    {% else %}
        <div id="carouselVestLavichy" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                {% for banner in banners %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <img src="{{ banner.imagem.url }}" class="d-block w-100" alt="{{ banner.titulo }}">
                    </div>
                {% empty %}
                    <div class="carousel-item active">
                        <img src="https://images.unsplash.com/photo-1520975916090-3105956dac38" class="d-block w-100">
                    </div>
                {% endfor %}
            </div>
            {% if banners|length > 1 %}
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselVestLavichy" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselVestLavichy" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
            </button>
            {% endif %}
        </div>

        <div class="container my-5">
            <div class="categorias-scroll text-center">
                {% for s in secoes %}
                    <a href="{% url 'vitrine_produtos' %}?secao={{ s.nome }}" class="categoria-item text-decoration-none">
                        <div class="cat-circle-img mx-auto"> 
                            {% if s.imagem %}
                                <img src="{{ s.imagem.url }}" alt="{{ s.nome }}">
                            {% else %}
                                <img src="https://via.placeholder.com/150/cccccc/ffffff?text={{ s.nome|slice:':1' }}">
                            {% endif %}
                        </div>
                        <span>{{ s.nome }}</span>
                    </a>
                {% endfor %}
            </div>
        </div>

{% if colecao_luxo %}
<div class="container my-5 position-relative section-moda">
    <h3 class="mb-4 text-center">ESTEJA SEMPRE NA MODA</h3>

    <div id="modaRow" class="row flex-nowrap overflow-auto g-4 pb-3 custom-slider no-scrollbar"
         style="scroll-behavior: smooth;">
        {% for item in colecao_luxo %}
        <div class="col-9 col-md-3 flex-shrink-0">
            <div class="card border-0 shadow-sm h-100">
                {% if item.produto_associado %}
                    <a href="{% url 'produto_detalhe' item.produto_associado.id %}">
                        <img src="{{ item.imagem.url }}" class="card-img-top rounded">
                    </a>
                {% else %}
                    <img src="{{ item.imagem.url }}" class="card-img-top rounded">
                {% endif %}
                <div class="card-body text-center">
                    <h6 class="card-title-lux" style="color: #333;">{{ item.nome }}</h6>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- SETAS -->
    <button class="btn-seta seta-esq d-none d-md-flex" onclick="scrollModa('left')">
        <span class="carousel-control-prev-icon"></span>
    </button>

    <button class="btn-seta seta-dir d-none d-md-flex" onclick="scrollModa('right')">
        <span class="carousel-control-next-icon"></span>
    </button>
</div>
{% endif %}


        <div class="container my-5 position-relative section-destaque">
            <h3 class="mb-4 text-center">Destaques</h3>
            <div id="destaqueRow" class="row flex-nowrap overflow-auto g-4 pb-3 no-scrollbar" style="scroll-behavior: smooth;">
                {% for produto in produtos_destaque %}
                <div class="col-9 col-md-3 flex-shrink-0">
                    <a href="{% url 'produto_detalhe' produto.id %}" class="text-decoration-none text-dark">
                        <div class="card h-100 border-0 shadow-sm">
                            {% if produto.novidade %}
                                <span class="badge-novo">NOVO!</span>
                            {% endif %}
                            {% if produto.imagens.first %}
                                <img src="{{ produto.imagens.first.imagem.url }}" class="card-img-top" alt="{{ produto.nome }}">
                            {% endif %}
                            <div class="card-body text-center">
                                <h6 class="text-truncate">{{ produto.nome }}</h6>
                                <p class="text-danger fw-bold m-0">R$ {{ produto.preco }}</p>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
            <button class="btn-seta seta-esq d-none d-md-flex" onclick="scrollSlider('left')">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="btn-seta seta-dir d-none d-md-flex" onclick="scrollSlider('right')">
                <span class="carousel-control-next-icon"></span>
            </button>
        </div>
    {% endif %}
</main>

<a href="{% url 'carrinho_detalhe' %}" class="carrinho-flutuante">
    ðŸ›’
    {% if request.session.carrinho %}
        <span class="badge-count">{{ request.session.carrinho|length }}</span>
    {% endif %}
</a>

<footer class="py-5 bg-light border-top mt-5 text-center">
    <div class="container">
        <h5>Vest Lavichy</h5>
        <p>Moda feminina inspirada em elegÃ¢ncia e sofisticaÃ§Ã£o</p>
        <a href="https://wa.me/5521977595943" target="_blank"><button class="btn-icon"><img src="../media/icones_categorias/iconZap.jpg" alt="BotÃ£o"></button></a>
        <a href="https://www.instagram.com/vest_lavichy" target="_blank"><button class="btn-icon"><img src="../media/icones_categorias/iconInsta.jpg" alt="BotÃ£o"></button></a>

        <p class="mt-2 small text-muted">Â© 2025 Vest Lavichy â€¢ Todos os direitos reservados</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'javascript/index.js' %}"></script>
</body>
</html>