{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Vest Lavichy</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/cadastro.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="card-cadastro">
    <div class="logo-cadastro">Vest Lavichy</div>
    <h5 class="text-center mb-4">Crie sua conta</h5>

<form method="POST">
    {% csrf_token %}
    <div class="mb-3">
        <label class="form-label">Nome de Usuário</label>
        <input type="text" name="usuario" class="form-control" required>
    </div>
    <div class="mb-3">
        <label class="form-label">E-mail</label>
        <input type="email" name="email" class="form-control" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Senha</label>
        <input type="password" name="senha" class="form-control" required>
    </div>

    <hr>
    <h6 class="text-muted">Dados de Entrega (Apenas RJ)</h6>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label">CEP</label>
            <input type="text" name="cep" id="id_cep" class="form-control" placeholder="00000-000" required>
        </div>
        <div class="col-md-6 mb-3">
            <label class="form-label">Telefone</label>
            <input type="text" name="telefone" class="form-control" placeholder="(21) 99999-9999" required>
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">Logradouro (Rua)</label>
        <input type="text" name="logradouro" id="id_logradouro" class="form-control" readonly>
    </div>

    <div class="row">
        <div class="col-6 mb-3">
            <label class="form-label">Número</label>
            <input type="text" name="numero" class="form-control" required>
        </div>
        <div class="col-6 mb-3">
            <label class="form-label">Bairro</label>
            <input type="text" name="bairro" id="id_bairro" class="form-control" readonly>
        </div>
    </div>

    <button type="submit" class="btn btn-principal w-100 mt-2">CADASTRAR E CONTINUAR</button>
</form>

    <div class="text-center mt-4">
        <span class="text-muted">Já tem uma conta?</span> <br>
        <a href="{% url 'login' %}" class="link-login">Faça login aqui</a>
    </div>
</div>

<script>
    document.getElementById('id_cep').addEventListener('blur', function() {
        let cep = this.value.replace(/\D/g, '');
        if (cep !== "") {
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (!data.erro) {
                        document.getElementById('id_logradouro').value = data.logradouro;
                        document.getElementById('id_bairro').value = data.bairro;
                        if(data.uf !== "RJ") alert("Atenção: Entregamos apenas no RJ!");
                    }
                });
        }
    });

// pra evitar erro de digitação do cliente no bairro 
document.getElementById('id_cep').addEventListener('blur', function() {
    let cep = this.value.replace(/\D/g, '');
    fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(res => res.json())
        .then(data => {
            if (!data.erro) {
                document.getElementById('id_logradouro').value = data.logradouro;
                document.getElementById('id_bairro').value = data.bairro;
                document.getElementById('id_cidade').value = data.localidade;
            }
        });
});
</script>

</body>
</html>